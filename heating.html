<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Heating Scale-Up (UA)</title>
    <style>
      :root {
        --ink: #1a1a1a;
        --ink-muted: #4a4a4a;
        --paper: #f6f3ee;
        --accent: #c06b3e;
        --accent-2: #2e6a8a;
        --panel: #fffaf3;
        --panel-2: #f0f6f8;
        --shadow: rgba(0, 0, 0, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        color: var(--ink);
        background:
          radial-gradient(1200px 800px at 10% 10%, #f9efe3 0%, transparent 60%),
          radial-gradient(900px 700px at 90% 20%, #e8f1f6 0%, transparent 55%),
          linear-gradient(160deg, #f7f1e8 0%, #f1efe7 45%, #eef2f1 100%);
        font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande", sans-serif;
      }

      header {
        padding: 36px 18px 20px;
        text-align: center;
      }

      header h1 {
        margin: 0;
        font-family: "Georgia", "Palatino Linotype", "Book Antiqua", serif;
        font-size: clamp(28px, 3.5vw, 44px);
        letter-spacing: 0.5px;
      }

      header p {
        margin: 10px auto 0;
        max-width: 760px;
        color: var(--ink-muted);
        font-size: clamp(14px, 1.6vw, 18px);
      }

      main {
        max-width: 1100px;
        margin: 0 auto 56px;
        padding: 0 18px;
        display: grid;
        gap: 22px;
      }

      .panel {
        background: var(--panel);
        border-radius: 18px;
        box-shadow: 0 14px 30px var(--shadow);
        padding: 20px;
        animation: rise 0.8s ease both;
      }

      .panel:nth-of-type(2) {
        background: var(--panel-2);
        animation-delay: 0.08s;
      }

      .panel:nth-of-type(3) {
        animation-delay: 0.16s;
      }

      .panel h2 {
        margin: 0 0 12px;
        font-size: 20px;
        letter-spacing: 0.2px;
      }

      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      .field {
        display: grid;
        gap: 6px;
        position: relative;
        padding-bottom: 28px;
      }

      label {
        font-size: 13px;
        color: var(--ink-muted);
        min-height: 32px;
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      .help {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        margin-left: 6px;
        border-radius: 50%;
        border: 1px solid rgba(26, 26, 26, 0.25);
        font-size: 11px;
        color: var(--ink-muted);
        position: relative;
        cursor: help;
      }

      .help::after {
        content: attr(data-tooltip);
        position: absolute;
        left: 50%;
        bottom: 140%;
        transform: translateX(-50%);
        background: #1f2a2f;
        color: #f7f5f0;
        padding: 8px 10px;
        border-radius: 8px;
        font-size: 12px;
        line-height: 1.3;
        min-width: 180px;
        max-width: 240px;
        text-align: left;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      .help::before {
        content: "";
        position: absolute;
        left: 50%;
        bottom: 120%;
        transform: translateX(-50%);
        border-width: 6px;
        border-style: solid;
        border-color: #1f2a2f transparent transparent transparent;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .help:hover::after,
      .help:hover::before {
        opacity: 1;
      }

      input {
        border: 1px solid #d4cfc6;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 15px;
        background: #fff;
        color: var(--ink);
      }

      input.needed {
        border-color: #c06b3e;
        background: #ffe8d6;
        box-shadow: 0 0 0 2px rgba(192, 107, 62, 0.2);
      }

      input:focus {
        outline: 2px solid rgba(192, 107, 62, 0.35);
        border-color: var(--accent);
      }

      .results {
        margin-top: 14px;
        padding-top: 14px;
        border-top: 1px dashed rgba(0, 0, 0, 0.2);
      }

      .pill {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(46, 106, 138, 0.12);
        color: var(--accent-2);
        font-size: 12px;
        margin-top: 4px;
      }

      .status {
        background: rgba(192, 107, 62, 0.15);
        color: #8a3c1a;
      }

      .status.ok {
        background: rgba(46, 138, 90, 0.15);
        color: #246347;
      }

      .note {
        font-size: 12px;
        color: var(--ink-muted);
        margin-top: 6px;
      }

      .hint {
        position: absolute;
        left: 0;
        bottom: 0;
        font-size: 12px;
        color: var(--ink-muted);
        max-width: 100%;
        line-height: 1.2;
      }

      footer {
        text-align: center;
        padding: 0 18px 24px;
        color: var(--ink-muted);
        font-size: 12px;
      }

      @keyframes rise {
        from {
          opacity: 0;
          transform: translateY(18px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Heating Scale-Up (UA)</h1>
      <p>
        Estimate UA using dynamic response or LMTD, then check if planned cooling
        can handle reaction heat.
      </p>
      <p><a href="index.html">Back to home</a></p>
    </header>

    <main>
      <section class="panel" id="method-a">
        <h2>Method A: Time Constant (tau-fit)</h2>
        <div class="grid">
          <div class="field">
            <label for="a-m">
              Liquid mass m (kg)
              <span class="help" data-tooltip="Vessel-side liquid mass to be cooled/heated.">?</span>
            </label>
            <input id="a-m" type="number" step="any" placeholder="e.g. 120" />
          </div>
          <div class="field">
            <label for="a-cp">
              Liquid heat capacity Cp (kJ/kg/K)
              <span class="help" data-tooltip="Heat capacity of the vessel liquid. You can type a value or a solvent name.">?</span>
            </label>
            <input id="a-cp" type="text" list="solvent-cp-list" placeholder="e.g. 4.2 or Acetone" />
            <div class="hint" id="a-cp-hint"></div>
          </div>
          <div class="field">
            <label for="a-mh">
              Hardware mass m_h (kg)
              <span class="help" data-tooltip="Optional metal or internal mass included in the thermal response.">?</span>
            </label>
            <input id="a-mh" type="number" step="any" placeholder="e.g. 40" />
          </div>
          <div class="field">
            <label for="a-cph">
              Hardware heat capacity Cp_h (kJ/kg/K)
              <span class="help" data-tooltip="Heat capacity of the included hardware mass.">?</span>
            </label>
            <input id="a-cph" type="number" step="any" placeholder="e.g. 0.5" />
          </div>
          <div class="field">
            <label for="a-tau">
              Time constant tau (s)
              <span class="help" data-tooltip="Fit from Tv(t)=Tj+(Tv0-Tj)*exp(-t/tau).">?</span>
            </label>
            <input id="a-tau" type="number" step="any" placeholder="e.g. 800" />
          </div>
        </div>
        <div class="results grid">
          <div class="field">
            <label>
              Effective mCp (kJ/K)
              <span class="help" data-tooltip="Combined heat capacity of liquid and hardware.">?</span>
            </label>
            <input id="a-mcp" readonly />
          </div>
          <div class="field">
            <label>
              UA (W/K)
              <span class="help" data-tooltip="Overall heat-transfer capacity from tau-fit.">?</span>
            </label>
            <input id="a-ua-w" readonly />
          </div>
          <div class="field">
            <label>
              UA (kW/K)
              <span class="help" data-tooltip="UA in kW/K for convenience.">?</span>
            </label>
            <input id="a-ua-kw" readonly />
          </div>
        </div>
        <div class="note">
          Use when you can fit a first-order response time constant from a cooling or heating step.
        </div>
      </section>

      <section class="panel" id="method-b">
        <h2>Method B: LMTD (Jacket Energy Balance)</h2>
        <div class="grid">
          <div class="field">
            <label for="b-mdot">
              Jacket mass flow m_dot (kg/s)
              <span class="help" data-tooltip="Direct mass flow input (overrides volumetric flow).">?</span>
            </label>
            <input id="b-mdot" type="number" step="any" placeholder="e.g. 0.6" />
          </div>
          <div class="field">
            <label for="b-vdot">
              Jacket volumetric flow (L/min)
              <span class="help" data-tooltip="Used with density to estimate mass flow.">?</span>
            </label>
            <input id="b-vdot" type="number" step="any" placeholder="e.g. 30" />
          </div>
          <div class="field">
            <label for="b-rho">
              Jacket density rho (kg/L)
              <span class="help" data-tooltip="Density for volumetric-to-mass flow conversion.">?</span>
            </label>
            <input id="b-rho" type="number" step="any" placeholder="e.g. 1" />
          </div>
          <div class="field">
            <label for="b-cp">
              Jacket heat capacity Cp_j (kJ/kg/K)
              <span class="help" data-tooltip="Heat capacity of the jacket fluid. You can type a value or a solvent name.">?</span>
            </label>
            <input id="b-cp" type="text" list="jacket-cp-list" placeholder="e.g. 4.2 or Water, fresh" />
            <div class="hint" id="b-cp-hint"></div>
          </div>
          <div class="field">
            <label for="b-tji">
              Jacket inlet T_j,i (C)
              <span class="help" data-tooltip="Jacket inlet temperature (cooling mode assumes Tv > Tj).">?</span>
            </label>
            <input id="b-tji" type="number" step="any" placeholder="e.g. 20" />
          </div>
          <div class="field">
            <label for="b-tjo">
              Jacket outlet T_j,o (C)
              <span class="help" data-tooltip="Jacket outlet temperature at steady conditions.">?</span>
            </label>
            <input id="b-tjo" type="number" step="any" placeholder="e.g. 30" />
          </div>
          <div class="field">
            <label for="b-tv">
              Vessel bulk T_v (C)
              <span class="help" data-tooltip="Bulk liquid temperature in the vessel.">?</span>
            </label>
            <input id="b-tv" type="number" step="any" placeholder="e.g. 60" />
          </div>
        </div>
        <div class="results grid">
          <div class="field">
            <label>
              Mass flow used (kg/s)
              <span class="help" data-tooltip="Mass flow selected from inputs for calculations.">?</span>
            </label>
            <input id="b-mdot-used" readonly />
          </div>
          <div class="field">
            <label>
              Heat duty Q (W)
              <span class="help" data-tooltip="Jacket heat duty from flow and temperature rise.">?</span>
            </label>
            <input id="b-q" readonly />
          </div>
          <div class="field">
            <label>
              LMTD (K)
              <span class="help" data-tooltip="Log-mean temperature difference for cooling mode.">?</span>
            </label>
            <input id="b-lmtd" readonly />
          </div>
          <div class="field">
            <label>
              UA (W/K)
              <span class="help" data-tooltip="Overall heat-transfer capacity from LMTD method.">?</span>
            </label>
            <input id="b-ua-w" readonly />
          </div>
          <div class="field">
            <label>
              UA (kW/K)
              <span class="help" data-tooltip="UA in kW/K for convenience.">?</span>
            </label>
            <input id="b-ua-kw" readonly />
          </div>
        </div>
        <div class="note">
          Use when steady jacket inlet/outlet temperatures are known. Cooling mode assumes Tv > Tj.
        </div>
      </section>

      <section class="panel" id="exotherm">
        <h2>Exotherm Check</h2>
        <div class="grid">
          <div class="field">
            <label>
              UA from Method A (kW/K)
              <span class="help" data-tooltip="UA from time-constant method, if valid.">?</span>
            </label>
            <input id="e-ua-a" readonly />
          </div>
          <div class="field">
            <label>
              UA from Method B (kW/K)
              <span class="help" data-tooltip="UA from LMTD method, if valid.">?</span>
            </label>
            <input id="e-ua-b" readonly />
          </div>
          <div class="field">
            <label>
              UA working (kW/K)
              <span class="help" data-tooltip="Conservative UA (min of A and B when both exist).">?</span>
            </label>
            <input id="e-ua-work" readonly />
          </div>
        </div>
        <div class="grid" style="margin-top: 10px;">
          <div class="field">
            <label for="e-dh">
              |Delta H_rxn| (kJ/mol)
              <span class="help" data-tooltip="Absolute reaction enthalpy per mol. Use calorimetry or trusted literature sources.">?</span>
            </label>
            <input id="e-dh" type="number" step="any" placeholder="e.g. 75" />
          </div>
          <div class="field">
            <label for="e-ndot">
              Molar rate n_dot (mol/h)
              <span class="help" data-tooltip="Planned feed or reaction molar rate.">?</span>
            </label>
            <input id="e-ndot" type="number" step="any" placeholder="e.g. 500" />
          </div>
          <div class="field">
            <label for="e-sf">
              Safety factor (SF)
              <span class="help" data-tooltip="Factor applied to reaction heat to add margin.">?</span>
            </label>
            <input id="e-sf" type="number" step="any" placeholder="e.g. 1.5" />
          </div>
          <div class="field">
            <label for="e-tv">
              Planned vessel T_v (C)
              <span class="help" data-tooltip="Target bulk temperature during reaction.">?</span>
            </label>
            <input id="e-tv" type="number" step="any" placeholder="e.g. 60" />
          </div>
          <div class="field">
            <label for="e-tji">
              Planned jacket inlet T_j,i (C)
              <span class="help" data-tooltip="Planned jacket inlet temperature.">?</span>
            </label>
            <input id="e-tji" type="number" step="any" placeholder="e.g. 20" />
          </div>
          <div class="field">
            <label for="e-mdot">
              Planned jacket flow m_dot (kg/s)
              <span class="help" data-tooltip="Optional. If blank, assumes high-flow limit.">?</span>
            </label>
            <input id="e-mdot" type="number" step="any" placeholder="optional" />
          </div>
          <div class="field">
            <label for="e-cp">
              Jacket heat capacity Cp_j (kJ/kg/K)
              <span class="help" data-tooltip="Heat capacity of the jacket fluid used in the plan. You can type a value or a solvent name.">?</span>
            </label>
            <input id="e-cp" type="text" list="jacket-cp-list" placeholder="e.g. 4.2 or Water, fresh" />
            <div class="hint" id="e-cp-hint"></div>
          </div>
        </div>
        <div class="results grid">
          <div class="field">
            <label>
              Q_rxn (kW)
              <span class="help" data-tooltip="Reaction heat rate without safety factor.">?</span>
            </label>
            <input id="e-qrxn" readonly />
          </div>
          <div class="field">
            <label>
              Q_req (kW)
              <span class="help" data-tooltip="Required removal with safety factor.">?</span>
            </label>
            <input id="e-qreq" readonly />
          </div>
          <div class="field">
            <label>
              Planned jacket outlet T_j,o (C)
              <span class="help" data-tooltip="Estimated outlet temperature from required duty.">?</span>
            </label>
            <input id="e-tjo" readonly />
          </div>
          <div class="field">
            <label>
              LMTD plan (K)
              <span class="help" data-tooltip="Log-mean temperature difference at planned conditions.">?</span>
            </label>
            <input id="e-lmtd" readonly />
          </div>
          <div class="field">
            <label>
              Q_removed plan (kW)
              <span class="help" data-tooltip="Cooling capacity at planned conditions.">?</span>
            </label>
            <input id="e-qremoved" readonly />
          </div>
          <div class="field">
            <label>
              Max safe n_dot (mol/h)
              <span class="help" data-tooltip="Maximum molar rate that matches cooling capacity.">?</span>
            </label>
            <input id="e-ndot-max" readonly />
          </div>
          <div class="field">
            <label>
              Status
              <span class="help" data-tooltip="OK if Q_removed >= Q_req, otherwise Risk.">?</span>
            </label>
            <span class="pill status" id="e-status">Enter inputs</span>
          </div>
        </div>
        <div class="note">
          UA working uses the minimum of Method A and B when both are valid.
        </div>
      </section>
    </main>

    <footer>
      Prototype only. Validate inputs, units, and assumptions before use.
    </footer>

    <datalist id="solvent-cp-list">
      <option value="Ammonia, 238 oF"></option>
      <option value="Ammonia, 211 oF"></option>
      <option value="Ammonia, 176 oF"></option>
      <option value="Ammonia, 104 oF"></option>
      <option value="Ammonia, 31 oF"></option>
      <option value="Water, fresh"></option>
      <option value="Milk"></option>
      <option value="Sodium hydrate"></option>
      <option value="Water, sea 36 oF"></option>
      <option value="Potassium hydrate"></option>
      <option value="Salt solution 20%"></option>
      <option value="Hydrochlor acid"></option>
      <option value="Calcium Chloride"></option>
      <option value="Propylene"></option>
      <option value="Alcohol, ethyl 104 oF (ethanol)"></option>
      <option value="Alcohol, methyl. 60 - 70 oF"></option>
      <option value="Methanol"></option>
      <option value="Methyl alcohol"></option>
      <option value="Propylene Glycol"></option>
      <option value="Alcohol, methyl. 40 - 50 oF"></option>
      <option value="Ethanol"></option>
      <option value="Ethanol 95%"></option>
      <option value="Glycerine"></option>
      <option value="Propane, 31 oF"></option>
      <option value="Alcohol, propyl"></option>
      <option value="Ethylene glycol"></option>
      <option value="Alcohol, ethyl 31 oF (ethanol)"></option>
      <option value="n-Butane, 31 oF"></option>
      <option value="Light Oil, 300 oF"></option>
      <option value="Hexane"></option>
      <option value="Heptane"></option>
      <option value="Ethyl ether"></option>
      <option value="Gasoline, petrol"></option>
      <option value="Decane"></option>
      <option value="Dodecane"></option>
      <option value="Ether"></option>
      <option value="Aniline"></option>
      <option value="Acetone"></option>
      <option value="Iodine"></option>
      <option value="Octane"></option>
      <option value="Paraffin"></option>
      <option value="Petroleum"></option>
      <option value="Benzine"></option>
      <option value="Asphalt, liquid"></option>
      <option value="Fuel Oil max."></option>
      <option value="Lubricating oil"></option>
      <option value="Diesel fuel"></option>
      <option value="Acetic acid"></option>
      <option value="Kerosene"></option>
      <option value="Oil, Castor"></option>
      <option value="Oil, Olive"></option>
      <option value="Olive oil"></option>
      <option value="Rapeseed oil"></option>
      <option value="Soya bean oil"></option>
      <option value="Diphenylamine"></option>
      <option value="Benzene, 150 oF"></option>
      <option value="Transformer oil"></option>
      <option value="Citron Oil"></option>
      <option value="Linseed Oil"></option>
      <option value="Benzene, 60 oF"></option>
      <option value="Benzol"></option>
      <option value="Castor Oil"></option>
      <option value="Light Oil, 60 oF"></option>
      <option value="Oil, turpentine"></option>
      <option value="Petroleum ether"></option>
      <option value="Naphthalene"></option>
      <option value="Nitric acid"></option>
      <option value="Toluene"></option>
      <option value="Turpentine oil"></option>
      <option value="Xylene"></option>
      <option value="Fuel Oil min."></option>
      <option value="Oil, mineral"></option>
      <option value="Oil, vegetable"></option>
      <option value="Sesame oil"></option>
      <option value="Tar"></option>
      <option value="Dowtherm"></option>
      <option value="Ethyl chloride"></option>
      <option value="Nitro benzole"></option>
      <option value="Tuluol"></option>
      <option value="Phenol"></option>
      <option value="Sodium, 200 oF"></option>
      <option value="Sulfuric acid concentrated"></option>
      <option value="Sulfuric acid"></option>
      <option value="Trichlor ethylene"></option>
      <option value="Sodium, 1000 oF"></option>
      <option value="Silicone oil"></option>
      <option value="Chloroform"></option>
      <option value="Dichlorodifluoromethane R-12 saturated 120 oF"></option>
      <option value="Carbon Disulfide"></option>
      <option value="Dichlorodifluoromethane R-12 saturated 0 oF"></option>
      <option value="Perchlor ethylene"></option>
      <option value="Dichlorodifluoromethane R-12 saturated -40 oF"></option>
      <option value="Carbon Tetrachloride"></option>
      <option value="Bromine"></option>
      <option value="Bismuth, 1400 oF"></option>
      <option value="Bismuth, 1000 oF"></option>
      <option value="Bismuth, 800 oF"></option>
      <option value="Mercury"></option>
    </datalist>
    <datalist id="jacket-cp-list">
      <option value="Water, fresh"></option>
      <option value="SYLTHERM HF (Low Temp)"></option>
      <option value="SYLTHERM 800 (High Temp)"></option>
      <option value="SYLTHERM XLT (Extra Low Temp)"></option>
      <option value="UOLEN 40 (-40 C)"></option>
      <option value="UOLEN 40 (0 C)"></option>
      <option value="UOLEN 40 (80 C)"></option>
      <option value="UOLEN 40 (120 C)"></option>
    </datalist>

    <script>
      let uaA = NaN;
      let uaB = NaN;

      const solventCp = new Map([
        ["ammonia, 238 of", 6.74],
        ["ammonia, 211 of", 6.2],
        ["ammonia, 176 of", 5.4],
        ["ammonia, 104 of", 4.86],
        ["ammonia, 31 of", 4.6],
        ["water, fresh", 4.19],
        ["milk", 3.93],
        ["sodium hydrate", 3.93],
        ["water, sea 36 of", 3.93],
        ["potassium hydrate", 3.68],
        ["salt solution 20%", 3.43],
        ["hydrochlor acid", 3.14],
        ["calcium chloride", 3.06],
        ["propylene", 2.85],
        ["alcohol, ethyl 104 of (ethanol)", 2.72],
        ["alcohol, methyl. 60 - 70 of", 2.51],
        ["methanol", 2.51],
        ["methyl alcohol", 2.51],
        ["propylene glycol", 2.5],
        ["alcohol, methyl. 40 - 50 of", 2.47],
        ["ethanol", 2.43],
        ["ethanol 95%", 2.43],
        ["glycerine", 2.43],
        ["propane, 31 of", 2.4],
        ["alcohol, propyl", 2.37],
        ["ethylene glycol", 2.36],
        ["alcohol, ethyl 31 of (ethanol)", 2.3],
        ["n-butane, 31 of", 2.3],
        ["light oil, 300 of", 2.3],
        ["hexane", 2.26],
        ["heptane", 2.24],
        ["ethyl ether", 2.22],
        ["gasoline, petrol", 2.22],
        ["decane", 2.21],
        ["dodecane", 2.21],
        ["ether", 2.21],
        ["aniline", 2.18],
        ["acetone", 2.15],
        ["iodine", 2.15],
        ["octane", 2.15],
        ["paraffin", 2.13],
        ["petroleum", 2.13],
        ["benzine", 2.1],
        ["asphalt, liquid", 2.09],
        ["fuel oil max.", 2.09],
        ["lubricating oil", 2.09],
        ["diesel fuel", 2.05],
        ["acetic acid", 2.043],
        ["kerosene", 2.01],
        ["oil, castor", 1.97],
        ["oil, olive", 1.97],
        ["olive oil", 1.97],
        ["rapeseed oil", 1.97],
        ["soya bean oil", 1.97],
        ["diphenylamine", 1.93],
        ["benzene, 150 of", 1.92],
        ["transformer oil", 1.88],
        ["citron oil", 1.84],
        ["linseed oil", 1.84],
        ["benzene, 60 of", 1.8],
        ["benzol", 1.8],
        ["castor oil", 1.8],
        ["light oil, 60 of", 1.8],
        ["oil, turpentine", 1.8],
        ["petroleum ether", 1.76],
        ["naphthalene", 1.72],
        ["nitric acid", 1.72],
        ["toluene", 1.72],
        ["turpentine oil", 1.72],
        ["xylene", 1.72],
        ["fuel oil min.", 1.67],
        ["oil, mineral", 1.67],
        ["oil, vegetable", 1.67],
        ["sesame oil", 1.63],
        ["tar", 1.56],
        ["dowtherm", 1.55],
        ["ethyl chloride", 1.54],
        ["nitro benzole", 1.52],
        ["tuluol", 1.51],
        ["phenol", 1.43],
        ["sodium, 200 of", 1.38],
        ["sulfuric acid concentrated", 1.38],
        ["sulfuric acid", 1.34],
        ["trichlor ethylene", 1.3],
        ["sodium, 1000 of", 1.26],
        ["silicone oil", 1.09],
        ["chloroform", 1.05],
        ["dichlorodifluoromethane r-12 saturated 120 of", 1.02],
        ["carbon disulfide", 0.992],
        ["dichlorodifluoromethane r-12 saturated 0 of", 0.91],
        ["perchlor ethylene", 0.905],
        ["dichlorodifluoromethane r-12 saturated -40 of", 0.88],
        ["carbon tetrachloride", 0.866],
        ["bromine", 0.47],
        ["bismuth, 1400 of", 0.165],
        ["bismuth, 1000 of", 0.155],
        ["bismuth, 800 of", 0.15],
        ["mercury", 0.14],
      ]);

      const jacketCp = new Map([
        ["water, fresh", 4.19],
        ["syltherm hf (low temp)", 0.445],
        ["syltherm 800 (high temp)", 0.45],
        ["syltherm xlt (extra low temp)", 0.445],
        ["uolen 40 (-40 c)", 1.8],
        ["uolen 40 (0 c)", 2.0],
        ["uolen 40 (80 c)", 2.3],
        ["uolen 40 (120 c)", 2.5],
      ]);

      function toNumber(value) {
        const number = Number(value);
        return Number.isFinite(number) ? number : NaN;
      }

      function normalizeName(value) {
        return String(value || "").toLowerCase().replace(/\s+/g, " ").trim();
      }

      function parseCp(value, lookup) {
        const trimmed = String(value || "").trim();
        if (!trimmed) {
          return NaN;
        }
        const numeric = Number(trimmed);
        if (Number.isFinite(numeric)) {
          return numeric;
        }
        const key = normalizeName(trimmed);
        if (lookup.has(key)) {
          return lookup.get(key);
        }
        return NaN;
      }

      function format(value) {
        if (!Number.isFinite(value)) {
          return "";
        }
        const abs = Math.abs(value);
        let output = "";
        if (abs >= 1000) {
          output = value.toFixed(2);
        } else if (abs >= 1) {
          output = value.toFixed(3);
        } else {
          output = value.toFixed(6);
        }
        return output.replace(/\.?0+$/, "");
      }

      function lmtD(deltaHi, deltaHo) {
        if (!(deltaHi > 0) || !(deltaHo > 0)) {
          return NaN;
        }
        const diff = Math.abs(deltaHi - deltaHo);
        if (diff < 1e-6) {
          return deltaHi;
        }
        return (deltaHi - deltaHo) / Math.log(deltaHi / deltaHo);
      }

      function updateCpHint(inputId, hintId, lookup) {
        const raw = document.getElementById(inputId).value;
        const key = normalizeName(raw);
        const hint = document.getElementById(hintId);
        if (lookup.has(key)) {
          const cp = lookup.get(key);
          hint.textContent = `Selected: ${raw} (${format(cp)} kJ/kg/K)`;
        } else {
          hint.textContent = "";
        }
      }

      function markNeeded(id, isNeeded) {
        const el = document.getElementById(id);
        if (!el) {
          return;
        }
        if (isNeeded) {
          el.classList.add("needed");
        } else {
          el.classList.remove("needed");
        }
      }

      function validateRequired() {
        const aM = toNumber(document.getElementById("a-m").value);
        const aCp = parseCp(document.getElementById("a-cp").value, solventCp);
        const aTau = toNumber(document.getElementById("a-tau").value);

        markNeeded("a-m", !(aM > 0));
        markNeeded("a-cp", !(aCp > 0));
        markNeeded("a-tau", !(aTau > 0));

        const bMdot = toNumber(document.getElementById("b-mdot").value);
        const bVdot = toNumber(document.getElementById("b-vdot").value);
        const bRho = toNumber(document.getElementById("b-rho").value);
        const bCp = parseCp(document.getElementById("b-cp").value, jacketCp);
        const bTji = toNumber(document.getElementById("b-tji").value);
        const bTjo = toNumber(document.getElementById("b-tjo").value);
        const bTv = toNumber(document.getElementById("b-tv").value);

        const hasMassFlow = bMdot > 0;
        const hasVolFlow = bVdot > 0 && bRho > 0;
        markNeeded("b-mdot", !hasMassFlow && !hasVolFlow);
        markNeeded("b-vdot", !hasMassFlow && !(bVdot > 0));
        markNeeded("b-rho", !hasMassFlow && !(bRho > 0));
        markNeeded("b-cp", !(bCp > 0));
        markNeeded("b-tji", !Number.isFinite(bTji));
        markNeeded("b-tjo", !Number.isFinite(bTjo));
        markNeeded("b-tv", !Number.isFinite(bTv));

        const eDh = Math.abs(toNumber(document.getElementById("e-dh").value));
        const eNdot = toNumber(document.getElementById("e-ndot").value);
        const eSf = toNumber(document.getElementById("e-sf").value);
        const eTvRaw = document.getElementById("e-tv").value;
        const eTjiRaw = document.getElementById("e-tji").value;
        const eTv = toNumber(eTvRaw);
        const eTji = toNumber(eTjiRaw);
        const eCp = parseCp(document.getElementById("e-cp").value, jacketCp);

        markNeeded("e-dh", !(eDh > 0));
        markNeeded("e-ndot", !(eNdot > 0));
        markNeeded("e-sf", !(eSf > 0));
        markNeeded("e-tv", eTvRaw.trim() === "" || !Number.isFinite(eTv));
        markNeeded("e-tji", eTjiRaw.trim() === "" || !Number.isFinite(eTji));
        markNeeded("e-cp", !(eCp > 0));
      }

      function calcMethodA() {
        const m = toNumber(document.getElementById("a-m").value);
        const cp = parseCp(document.getElementById("a-cp").value, solventCp);
        const mh = toNumber(document.getElementById("a-mh").value);
        const cph = toNumber(document.getElementById("a-cph").value);
        const tau = toNumber(document.getElementById("a-tau").value);

        const mcpEff = (m > 0 && cp > 0 ? m * cp : 0) + (mh > 0 && cph > 0 ? mh * cph : 0);
        const uaW = tau > 0 ? (mcpEff * 1000) / tau : NaN;
        const uaKw = Number.isFinite(uaW) ? uaW / 1000 : NaN;

        uaA = uaKw;

        document.getElementById("a-mcp").value = format(mcpEff);
        document.getElementById("a-ua-w").value = format(uaW);
        document.getElementById("a-ua-kw").value = format(uaKw);
      }

      function calcMethodB() {
        const mdotInput = toNumber(document.getElementById("b-mdot").value);
        const vdot = toNumber(document.getElementById("b-vdot").value);
        const rho = toNumber(document.getElementById("b-rho").value);
        const cp = parseCp(document.getElementById("b-cp").value, jacketCp);
        const tji = toNumber(document.getElementById("b-tji").value);
        const tjo = toNumber(document.getElementById("b-tjo").value);
        const tv = toNumber(document.getElementById("b-tv").value);

        let mdot = mdotInput;
        if (!(mdot > 0) && vdot > 0 && rho > 0) {
          mdot = (vdot * rho) / 60;
        }

        const q = mdot > 0 && cp > 0 ? mdot * cp * 1000 * (tjo - tji) : NaN;
        const deltaHi = tv - tji;
        const deltaHo = tv - tjo;
        const lmtd = lmtD(deltaHi, deltaHo);
        const uaW = Number.isFinite(q) && Number.isFinite(lmtd) ? q / lmtd : NaN;
        const uaKw = Number.isFinite(uaW) ? uaW / 1000 : NaN;

        uaB = uaKw;

        document.getElementById("b-mdot-used").value = format(mdot);
        document.getElementById("b-q").value = format(q);
        document.getElementById("b-lmtd").value = format(lmtd);
        document.getElementById("b-ua-w").value = format(uaW);
        document.getElementById("b-ua-kw").value = format(uaKw);
      }

      function calcExotherm() {
        const dh = Math.abs(toNumber(document.getElementById("e-dh").value));
        const ndot = toNumber(document.getElementById("e-ndot").value);
        const sf = toNumber(document.getElementById("e-sf").value);
        const tv = toNumber(document.getElementById("e-tv").value);
        const tji = toNumber(document.getElementById("e-tji").value);
        const mdot = toNumber(document.getElementById("e-mdot").value);
        const cp = parseCp(document.getElementById("e-cp").value, jacketCp);

        const uaWork =
          uaA > 0 && uaB > 0 ? Math.min(uaA, uaB) : uaA > 0 ? uaA : uaB > 0 ? uaB : NaN;

        const qRxn = dh > 0 && ndot > 0 ? (dh * ndot) / 3600 : NaN;
        const qReq = Number.isFinite(qRxn) && sf > 0 ? qRxn * sf : NaN;

        let tjo = tji;
        if (mdot > 0 && cp > 0 && Number.isFinite(qReq)) {
          tjo = tji + qReq / (mdot * cp);
        }

        const deltaHi = tv - tji;
        const deltaHo = tv - tjo;
        const lmtd = lmtD(deltaHi, deltaHo);
        const qRemoved = uaWork > 0 && Number.isFinite(lmtd) ? uaWork * lmtd : NaN;
        const ndotMax =
          qRemoved > 0 && dh > 0 && sf > 0 ? (qRemoved * 3600) / (dh * sf) : NaN;

        document.getElementById("e-ua-a").value = format(uaA);
        document.getElementById("e-ua-b").value = format(uaB);
        document.getElementById("e-ua-work").value = format(uaWork);
        document.getElementById("e-qrxn").value = format(qRxn);
        document.getElementById("e-qreq").value = format(qReq);
        document.getElementById("e-tjo").value = format(tjo);
        document.getElementById("e-lmtd").value = format(lmtd);
        document.getElementById("e-qremoved").value = format(qRemoved);
        document.getElementById("e-ndot-max").value = format(ndotMax);

        const statusEl = document.getElementById("e-status");
        statusEl.classList.remove("ok");
        if (Number.isFinite(qRemoved) && Number.isFinite(qReq)) {
          if (qRemoved >= qReq) {
            statusEl.textContent = "OK";
            statusEl.classList.add("ok");
          } else {
            statusEl.textContent = "Risk";
          }
        } else {
          statusEl.textContent = "Enter inputs";
        }
      }

      function recalc() {
        updateCpHint("a-cp", "a-cp-hint", solventCp);
        updateCpHint("b-cp", "b-cp-hint", jacketCp);
        updateCpHint("e-cp", "e-cp-hint", jacketCp);
        validateRequired();
        calcMethodA();
        calcMethodB();
        calcExotherm();
      }

      function wire() {
        const inputs = document.querySelectorAll("input:not([readonly])");
        inputs.forEach((input) => {
          input.addEventListener("input", recalc);
        });
        recalc();
      }

      window.addEventListener("DOMContentLoaded", wire);
    </script>
  </body>
</html>
